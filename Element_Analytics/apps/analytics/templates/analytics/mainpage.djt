<!DOCTYPE html>
<html lang="en">
{% extends "userbase.djt" %}
{% block section1 %}
<h1>Analytics</h1>
{% endblock %}
{% block section2 %}
{% load static %}
<script type="text/javascript" src="{% static "fusioncharts/fusioncharts.js" %}"></script>
<script type="text/javascript" src="{% static "fusioncharts/themes/fusioncharts.theme.fint.js" %}"></script>
<script type="text/javascript" src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<div id="chartContainer0"></div>
<div id="chartContainer">
<script type="text/javascript">
var entries = [];
var keys = [];
$.ajax({
     async: false,
     type: 'GET',
     url: "/api/error_analytics/{{ log_name }}",
     success: function(data) {
     	var parsed = JSON.parse(data); 
     	var obj = parsed.error_by_dates;
        var key_errors = parsed.error_by_keywords;
        for (var key in obj) {
  			if (obj.hasOwnProperty(key)) {
    			var val = obj[key];
    			entries.push({ "label" : key, "value" : val, "color": "008ee4", "stepSkipped": false, "appliedSmartLabel": true });
     		}
     	}
     	for (var key in key_errors) {
     		var val = key_errors[key];
     		keys.push({ "label" : key, "value" : val });
     	}
     }
});
FusionCharts.ready(function() {
            var revenueChart = new FusionCharts({
                "type": "column2d",
                "renderAt": "chartContainer0",
                "width": "100%",
                "height": "100%",
                "dataFormat": "json",
                "dataSource": {
                    "chart": {
                        "caption": "Errors by keywords",
                        "xAxisName": "Keywords",
                        "yAxisName": "# Errors",
                        "theme": "fint"
                    },
                    "data": keys
                }

            });
            revenueChart.render();
        })
FusionCharts.ready(function() {
    var revenueChart = new FusionCharts({
        "type": "line",
        "renderAt": "chartContainer",
        "width": "100%",
        "height": "100%",
        "dataFormat": "json",
        "dataSource": {
        	"chart": {
        		"caption": "Error by dates",
        		"numberprefix": "",
        		"bgcolor": "FFFFFF",
        		"showalternatehgridcolor": "0",
        		"plotbordercolor": "008ee4",
        		"plotborderthickness": "3",
        		"showvalues": "0",
        		"divlinecolor": "CCCCCC",
        		"showcanvasborder": "0",
        		"tooltipbgcolor": "00396d",
        		"tooltipcolor": "FFFFFF",
        		"tooltipbordercolor": "00396d",
        		"numdivlines": "2",
        		"yaxisvaluespadding": "20",
        		"anchorbgcolor": "008ee4",
        		"anchorborderthickness": "0",
        		"showshadow": "1",
       			"anchorradius": "4",
        		"chartrightmargin": "25",
        		"canvasborderalpha": "0",
        		"showborder": "0"
   	 		},
        	"data" : entries
        }
    });
    revenueChart.render();
})
</script>

</div>
{% endblock %}
</html>